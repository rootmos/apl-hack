P←458 ⋄ M←71307
f←{0=23|⊃⍵:(1+⊃⍵),(⊂¯1⌽1↓x),⊂(⊃⍵[3])+(⊃⍵+⊃x←7⌽⊃⍵[2])×(1+P|⊃⍵)=⍳⍴⊃⍵[3] ⋄ (1+⊃⍵),(⊂(⊃⍵),¯1⌽⊃⍵[2]),⍵[3]}
⌈/⊃3⌷f⍣M⊢1,(⊂0),(⊂P⍴0)
